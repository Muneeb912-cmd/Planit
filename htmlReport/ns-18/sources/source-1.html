


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > AddEditEventFragment</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.example.eventmanagement.ui.bottom_sheet_dialogs.event_details.add_edit_event</a>
</div>

<h1>Coverage Summary for Class: AddEditEventFragment (com.example.eventmanagement.ui.bottom_sheet_dialogs.event_details.add_edit_event)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">AddEditEventFragment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/35)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/232)
  </span>
</td>
</tr>
  <tr>
    <td class="name">AddEditEventFragment$initializeListeners$lambda$17$$inlined$addTextChangedListener$default$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$initializeListeners$lambda$17$$inlined$addTextChangedListener$default$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$observeSaveEventState$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$observeSaveEventState$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$showTimePicker$timePickerDialog$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$special$$inlined$activityViewModels$default$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$special$$inlined$activityViewModels$default$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$special$$inlined$activityViewModels$default$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$special$$inlined$viewModels$default$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$special$$inlined$viewModels$default$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$special$$inlined$viewModels$default$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$special$$inlined$viewModels$default$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$special$$inlined$viewModels$default$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$validateFields$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AddEditEventFragment$validateFields$1$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/56)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/288)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.example.eventmanagement.ui.bottom_sheet_dialogs.event_details.add_edit_event
&nbsp;
&nbsp;import android.R
&nbsp;import android.annotation.SuppressLint
&nbsp;import android.app.Activity
&nbsp;import android.app.DatePickerDialog
&nbsp;import android.app.TimePickerDialog
&nbsp;import android.content.DialogInterface
&nbsp;import android.content.Intent
&nbsp;import android.os.Build
&nbsp;import android.os.Bundle
&nbsp;import android.view.LayoutInflater
&nbsp;import android.view.View
&nbsp;import android.view.ViewGroup
&nbsp;import android.widget.ArrayAdapter
&nbsp;import android.widget.EditText
&nbsp;import android.widget.Toast
&nbsp;import androidx.activity.result.contract.ActivityResultContracts
&nbsp;import androidx.annotation.RequiresApi
&nbsp;import androidx.core.widget.addTextChangedListener
&nbsp;import androidx.fragment.app.activityViewModels
&nbsp;import androidx.fragment.app.viewModels
&nbsp;import androidx.lifecycle.lifecycleScope
&nbsp;import com.example.eventmanagement.databinding.FragmentAddEditEventBinding
&nbsp;import com.example.eventmanagement.di.Categories
&nbsp;import com.example.eventmanagement.models.EventData
&nbsp;import com.example.eventmanagement.ui.shared_view_model.SharedViewModel
&nbsp;import com.example.eventmanagement.utils.Response
&nbsp;import com.google.android.material.bottomsheet.BottomSheetDialogFragment
&nbsp;import com.google.android.material.dialog.MaterialAlertDialogBuilder
&nbsp;import dagger.hilt.android.AndroidEntryPoint
&nbsp;import kotlinx.coroutines.launch
&nbsp;import java.util.Calendar
&nbsp;import javax.inject.Inject
&nbsp;
&nbsp;@AndroidEntryPoint
<b class="nc">&nbsp;class AddEditEventFragment : BottomSheetDialogFragment() {</b>
&nbsp;
&nbsp;    private lateinit var binding: FragmentAddEditEventBinding
&nbsp;    private lateinit var eventLongitude: String
&nbsp;    private lateinit var eventLatitude: String
&nbsp;    private var onDismissListener: (() -&gt; Unit)? = null
&nbsp;
&nbsp;    @Inject
&nbsp;    @Categories
<b class="nc">&nbsp;    lateinit var categories: ArrayList&lt;String&gt;</b>
<b class="nc">&nbsp;    private val viewModel: AddEditEventViewModel by viewModels()</b>
<b class="nc">&nbsp;    private val sharedViewModel: SharedViewModel by activityViewModels()</b>
&nbsp;    private var key: String? = null
&nbsp;    private var eventData: EventData? = null
&nbsp;
&nbsp;    override fun onCreateView(
&nbsp;        inflater: LayoutInflater, container: ViewGroup?,
&nbsp;        savedInstanceState: Bundle?
&nbsp;    ): View {
<b class="nc">&nbsp;        binding = FragmentAddEditEventBinding.inflate(inflater, container, false)</b>
&nbsp;
<b class="nc">&nbsp;        arguments?.let {</b>
<b class="nc">&nbsp;            key = it.getString(&quot;key&quot;)</b>
<b class="nc">&nbsp;            eventData = it.getSerializable(&quot;eventData&quot;) as EventData?</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        // Populate data if updating
<b class="nc">&nbsp;        if (key == &quot;update&quot;) {</b>
<b class="nc">&nbsp;            populateEventData(eventData)</b>
<b class="nc">&nbsp;            binding.saveEventBtn.text = &quot;Update&quot;</b>
<b class="nc">&nbsp;            binding.addEditTitle.text=&quot;Update Event&quot;</b>
&nbsp;        }
<b class="nc">&nbsp;        return binding.root</b>
&nbsp;    }
&nbsp;
&nbsp;    @RequiresApi(Build.VERSION_CODES.O)
&nbsp;    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
<b class="nc">&nbsp;        super.onViewCreated(view, savedInstanceState)</b>
<b class="nc">&nbsp;        populateDropDown()</b>
<b class="nc">&nbsp;        if (key == &quot;create&quot;) updateEventInfo()</b>
<b class="nc">&nbsp;        initializeListeners()</b>
<b class="nc">&nbsp;        validateFields()</b>
&nbsp;    }
<b class="nc">&nbsp;</b>
&nbsp;
<b class="nc">&nbsp;    private fun populateEventData(eventData: EventData?) {</b>
<b class="nc">&nbsp;        eventData?.let {</b>
<b class="nc">&nbsp;            binding.eventTitle.setText(it.eventTitle)</b>
<b class="nc">&nbsp;            binding.eventCategory.setText(it.eventCategory)</b>
<b class="nc">&nbsp;            binding.eventLocation.setText(it.eventLocation)</b>
<b class="nc">&nbsp;            binding.eventFeaturedToggle.isChecked = it.isEventFeatured == true</b>
<b class="nc">&nbsp;            binding.visibilityToggle.isChecked = it.isEventPublic == true</b>
<b class="nc">&nbsp;            binding.eventDescription.setText(it.eventDescription)</b>
<b class="nc">&nbsp;            binding.eventCategory.setText(it.eventCategory)</b>
&nbsp;
&nbsp;            // Handle date range
<b class="nc">&nbsp;            if (!it.eventDate.isNullOrEmpty()) {</b>
<b class="nc">&nbsp;                val dates = it.eventDate!!.split(&quot; - &quot;)</b>
<b class="nc">&nbsp;                if (dates.size == 2) {</b>
<b class="nc">&nbsp;                    binding.eventDate.setText(dates[0])</b>
<b class="nc">&nbsp;                    binding.eventEndDate.setText(dates[1])</b>
<b class="nc">&nbsp;                    binding.rangePickerCheckBox.isChecked = true</b>
<b class="nc">&nbsp;                    binding.eventEndDateLayout.visibility = View.VISIBLE</b>
<b class="nc">&nbsp;                } else {</b>
<b class="nc">&nbsp;                    binding.eventDate.setText(it.eventDate)</b>
<b class="nc">&nbsp;                    binding.eventEndDate.setText(&quot;&quot;)</b>
<b class="nc">&nbsp;                    binding.rangePickerCheckBox.isChecked = false</b>
<b class="nc">&nbsp;                    binding.eventEndDateLayout.visibility = View.GONE</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;</b>
<b class="nc">&nbsp;            if (!it.eventTiming.isNullOrEmpty()) {</b>
<b class="nc">&nbsp;                val startTime = it.eventTiming!!.split(&quot; - &quot;)</b>
<b class="nc">&nbsp;                if (startTime.size == 2) {</b>
<b class="nc">&nbsp;                    binding.eventStartTime.setText(startTime[0])</b>
<b class="nc">&nbsp;                    binding.eventEndTime.setText(startTime[1])</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    binding.eventStartTime.setText(it.eventTiming)</b>
<b class="nc">&nbsp;                    binding.eventEndTime.setText(&quot;&quot;)</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            updateDataInViewModel(it)</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
<b class="nc">&nbsp;</b>
<b class="nc">&nbsp;    private fun updateDataInViewModel(it: EventData) {</b>
&nbsp;        // Update ViewModel with existing event data
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventId&quot;, it.eventId ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventTitle&quot;, it.eventTitle ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventOrganizer&quot;, it.eventOrganizer ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventTiming&quot;, it.eventTiming ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventCategory&quot;, it.eventCategory ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventDescription&quot;, it.eventDescription ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventLocation&quot;, it.eventLocation ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventDate&quot;, it.eventDate ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(</b>
<b class="nc">&nbsp;            &quot;isEventFeatured&quot;,</b>
<b class="nc">&nbsp;            if (it.isEventFeatured == true) &quot;yes&quot; else &quot;no&quot;</b>
&nbsp;        )
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;isEventPopular&quot;, if (it.isEventPopular == true) &quot;yes&quot; else &quot;no&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(</b>
<b class="nc">&nbsp;            &quot;numberOfPeopleAttending&quot;,</b>
<b class="nc">&nbsp;            it.numberOfPeopleAttending?.toString() ?: &quot;&quot;</b>
&nbsp;        )
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;isEventPublic&quot;, if (it.isEventPublic == true) &quot;yes&quot; else &quot;no&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventStatus&quot;, it.eventStatus ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventCreatedBy&quot;, it.eventCreatedBy ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventLong&quot;, it.eventLong ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;eventLat&quot;, it.eventLat ?: &quot;&quot;)</b>
<b class="nc">&nbsp;        viewModel.updateEventInfo(&quot;isEventDeleted&quot;, if (it.isEventDeleted == true) &quot;yes&quot; else &quot;no&quot;)</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private fun validateFields() {
<b class="nc">&nbsp;        lifecycleScope.launch {</b>
<b class="nc">&nbsp;            viewModel.errors.collect { errorMap -&gt;</b>
<b class="nc">&nbsp;                binding.eventTitle.error = errorMap[&quot;eventTitle&quot;]</b>
<b class="nc">&nbsp;                binding.eventCategory.error = errorMap[&quot;eventCategory&quot;]</b>
<b class="nc">&nbsp;                binding.eventLocation.error = errorMap[&quot;eventLocation&quot;]</b>
<b class="nc">&nbsp;                binding.eventDescription.error = errorMap[&quot;eventDescription&quot;]</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun updateEventInfo() {
<b class="nc">&nbsp;        val currentUser = sharedViewModel.currentUser.value</b>
<b class="nc">&nbsp;        if (currentUser != null) {</b>
<b class="nc">&nbsp;            viewModel.updateEventInfo(&quot;eventOrganizer&quot;, currentUser.userName.toString())</b>
<b class="nc">&nbsp;            viewModel.updateEventInfo(&quot;eventCreatedBy&quot;, currentUser.userId.toString())</b>
<b class="nc">&nbsp;            viewModel.updateEventInfo(&quot;numberOfPeopleAttending&quot;, &quot;0&quot;)</b>
<b class="nc">&nbsp;            viewModel.updateEventInfo(&quot;isEventPopular&quot;, &quot;no&quot;)</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun populateDropDown() {
<b class="nc">&nbsp;        val adapter =</b>
<b class="nc">&nbsp;            ArrayAdapter(requireContext(), R.layout.simple_dropdown_item_1line, categories)</b>
<b class="nc">&nbsp;        binding.eventCategory.setAdapter(adapter)</b>
<b class="nc">&nbsp;        binding.eventCategory.setOnItemClickListener { parent, _, position, _ -&gt;</b>
<b class="nc">&nbsp;            val selectedCategory = parent.getItemAtPosition(position).toString()</b>
<b class="nc">&nbsp;            viewModel.updateEventInfo(&quot;eventCategory&quot;, selectedCategory)</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    @RequiresApi(Build.VERSION_CODES.O)
&nbsp;    private fun initializeListeners() {
<b class="nc">&nbsp;        binding.saveEventBtn.setOnClickListener {</b>
<b class="nc">&nbsp;            if (key == &quot;create&quot;) {</b>
<b class="nc">&nbsp;                viewModel.saveEvent()</b>
<b class="nc">&nbsp;            } else if (key == &quot;update&quot;) {</b>
<b class="nc">&nbsp;                viewModel.saveEvent()</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        with(binding) {</b>
<b class="nc">&nbsp;            eventTitle.addTextChangedListener {</b>
&nbsp;                viewModel.updateEventInfo(&quot;eventTitle&quot;, it.toString())
&nbsp;            }
<b class="nc">&nbsp;            eventDate.setOnClickListener {</b>
<b class="nc">&nbsp;                showDatePicker(eventDate, &quot;eventDate&quot;)</b>
&nbsp;            }
<b class="nc">&nbsp;            rangePickerCheckBox.setOnClickListener {</b>
<b class="nc">&nbsp;                toggleEndDateVisibility()</b>
&nbsp;            }
<b class="nc">&nbsp;            eventEndDate.setOnClickListener {</b>
<b class="nc">&nbsp;                showDatePicker(eventEndDate, &quot;eventEndDate&quot;)</b>
&nbsp;            }
<b class="nc">&nbsp;            eventStartTime.setOnClickListener {</b>
<b class="nc">&nbsp;                showTimePicker(eventStartTime, &quot;startTime&quot;)</b>
&nbsp;            }
<b class="nc">&nbsp;            eventEndTime.setOnClickListener {</b>
<b class="nc">&nbsp;                showTimePicker(eventEndTime, &quot;endTime&quot;)</b>
&nbsp;            }
<b class="nc">&nbsp;            eventLocation.setOnClickListener {</b>
<b class="nc">&nbsp;                val intent = Intent(requireContext(), LocationSearchActivity::class.java)</b>
<b class="nc">&nbsp;                locationSearchLauncher.launch(intent)</b>
&nbsp;            }
<b class="nc">&nbsp;            saveEventBtn.setOnClickListener {</b>
<b class="nc">&nbsp;                if (viewModel.isDataComplete) {</b>
<b class="nc">&nbsp;                    if (viewModel.isDataValid) {</b>
<b class="nc">&nbsp;                        observeSaveEventState()</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        showGenericDialog(</b>
<b class="nc">&nbsp;                            message = &quot;Error: Couldn&#39;t validate the input data, please check and try again!&quot;,</b>
<b class="nc">&nbsp;                            title = &quot;Input Data Not Valid&quot;,</b>
<b class="nc">&nbsp;                            iconResId = com.example.eventmanagement.R.drawable.ic_attention</b>
&nbsp;                        )
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    showGenericDialog(</b>
<b class="nc">&nbsp;                        message = &quot;One or more input fields are empty. Kindly fill in the information before saving.&quot;,</b>
<b class="nc">&nbsp;                        title = &quot;Field Empty&quot;,</b>
<b class="nc">&nbsp;                        iconResId = com.example.eventmanagement.R.drawable.ic_attention</b>
&nbsp;                    )
&nbsp;
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            closeBottomSheet.setOnClickListener {</b>
<b class="nc">&nbsp;                dismiss()</b>
&nbsp;            }
<b class="nc">&nbsp;            cancelBtn.setOnClickListener {</b>
<b class="nc">&nbsp;                dismiss()</b>
&nbsp;            }
<b class="nc">&nbsp;            eventFeaturedToggle.setOnClickListener {</b>
<b class="nc">&nbsp;                if (eventFeaturedToggle.isChecked) {</b>
<b class="nc">&nbsp;                    viewModel.updateEventInfo(&quot;isEventFeatured&quot;, &quot;yes&quot;)</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    viewModel.updateEventInfo(&quot;isEventFeatured&quot;, &quot;no&quot;)</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            visibilityToggle.setOnClickListener {</b>
<b class="nc">&nbsp;                if (visibilityToggle.isChecked) {</b>
<b class="nc">&nbsp;                    viewModel.updateEventInfo(&quot;isEventPublic&quot;, &quot;yes&quot;)</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    viewModel.updateEventInfo(&quot;isEventPublic&quot;, &quot;no&quot;)</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            eventDescription.addTextChangedListener {</b>
&nbsp;                viewModel.updateEventInfo(&quot;eventDescription&quot;, it.toString())
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    private fun toggleEndDateVisibility() {
<b class="nc">&nbsp;        if (binding.rangePickerCheckBox.isChecked) {</b>
<b class="nc">&nbsp;            binding.eventEndDateLayout.visibility = View.VISIBLE</b>
&nbsp;        } else {
<b class="nc">&nbsp;            viewModel.updateEventInfo(&quot;eventDate&quot;, binding.eventEndDate.text.toString())</b>
<b class="nc">&nbsp;            binding.eventEndDateLayout.visibility = View.GONE</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @SuppressLint(&quot;SetTextI18n&quot;, &quot;DefaultLocale&quot;)
&nbsp;    private fun showDatePicker(editText: EditText, updateKey: String) {
<b class="nc">&nbsp;        val calendar = Calendar.getInstance()</b>
&nbsp;
<b class="nc">&nbsp;        val datePickerDialog = DatePickerDialog(</b>
<b class="nc">&nbsp;            requireContext(),</b>
&nbsp;            { _, year, month, day -&gt;
<b class="nc">&nbsp;                val formattedMonth = String.format(&quot;%02d&quot;, month + 1)</b>
<b class="nc">&nbsp;                val formattedDay = String.format(&quot;%02d&quot;, day)</b>
<b class="nc">&nbsp;                val formattedDate = &quot;$year-$formattedMonth-$formattedDay&quot;</b>
<b class="nc">&nbsp;                editText.setText(formattedDate)</b>
&nbsp;
<b class="nc">&nbsp;                if (updateKey == &quot;eventDate&quot;) {</b>
<b class="nc">&nbsp;                    viewModel.updateEventInfo(&quot;eventDate&quot;, formattedDate)</b>
<b class="nc">&nbsp;                } else if (updateKey == &quot;eventEndDate&quot;) {</b>
<b class="nc">&nbsp;                    val startDate = binding.eventDate.text.toString()</b>
<b class="nc">&nbsp;                    viewModel.updateEventInfo(&quot;eventDate&quot;, &quot;$startDate - $formattedDate&quot;)</b>
&nbsp;                }
&nbsp;            },
<b class="nc">&nbsp;            calendar.get(Calendar.YEAR),</b>
<b class="nc">&nbsp;            calendar.get(Calendar.MONTH),</b>
<b class="nc">&nbsp;            calendar.get(Calendar.DAY_OF_MONTH)</b>
&nbsp;        )
<b class="nc">&nbsp;        when (updateKey) {</b>
<b class="nc">&nbsp;            &quot;eventDate&quot; -&gt; {</b>
<b class="nc">&nbsp;                datePickerDialog.datePicker.minDate = calendar.timeInMillis</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            &quot;eventEndDate&quot; -&gt; {</b>
<b class="nc">&nbsp;                val startDate = binding.eventDate.text.toString()</b>
<b class="nc">&nbsp;                if (startDate.isNotEmpty()) {</b>
<b class="nc">&nbsp;                    val startDateCalendar = Calendar.getInstance().apply {</b>
<b class="nc">&nbsp;                        val dateParts = startDate.split(&quot;-&quot;)</b>
<b class="nc">&nbsp;                        set(dateParts[0].toInt(), dateParts[1].toInt() - 1, dateParts[2].toInt())</b>
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                    startDateCalendar.add(Calendar.DAY_OF_MONTH, 1)</b>
<b class="nc">&nbsp;                    datePickerDialog.datePicker.minDate = startDateCalendar.timeInMillis</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        datePickerDialog.show()</b>
&nbsp;    }
&nbsp;
&nbsp;    @SuppressLint(&quot;SetTextI18n&quot;, &quot;DefaultLocale&quot;)
&nbsp;    private fun showTimePicker(editText: EditText, updateKey: String) {
<b class="nc">&nbsp;        val calendar = Calendar.getInstance()</b>
<b class="nc">&nbsp;        val timePickerDialog = TimePickerDialog(</b>
<b class="nc">&nbsp;            requireContext(),</b>
&nbsp;            { _, hourOfDay, minute -&gt;
<b class="nc">&nbsp;                val formattedTime = if (is24HourFormat()) {</b>
<b class="nc">&nbsp;                    String.format(&quot;%02d:%02d&quot;, hourOfDay, minute)</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    val hour =</b>
<b class="nc">&nbsp;                        if (hourOfDay == 0) 12 else if (hourOfDay &gt; 12) hourOfDay - 12 else hourOfDay</b>
<b class="nc">&nbsp;                    val amPm = if (hourOfDay &lt; 12) &quot;AM&quot; else &quot;PM&quot;</b>
<b class="nc">&nbsp;                    String.format(&quot;%02d:%02d %s&quot;, hour, minute, amPm)</b>
&nbsp;                }
<b class="nc">&nbsp;                editText.setText(formattedTime)</b>
<b class="nc">&nbsp;                if (updateKey == &quot;endTime&quot;) {</b>
<b class="nc">&nbsp;                    viewModel.updateEventInfo(</b>
<b class="nc">&nbsp;                        &quot;eventTiming&quot;,</b>
<b class="nc">&nbsp;                        &quot;${binding.eventStartTime.text.toString()} - ${binding.eventEndTime.text.toString()}&quot;</b>
&nbsp;                    )
&nbsp;                }
<b class="nc">&nbsp;                viewModel.validateEventTiming(</b>
<b class="nc">&nbsp;                    &quot;${binding.eventStartTime.text.toString()} - ${binding.eventEndTime.text.toString()}&quot;</b>
&nbsp;                ) { result, msg, fieldType -&gt;
<b class="nc">&nbsp;                    if (result) {</b>
<b class="nc">&nbsp;                        binding.eventStartTime.error = null</b>
<b class="nc">&nbsp;                        binding.eventEndTime.error = null</b>
<b class="nc">&nbsp;                        binding.timeError.visibility = View.GONE</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        binding.timeError.visibility = View.VISIBLE</b>
<b class="nc">&nbsp;                        binding.timeError.text = msg</b>
<b class="nc">&nbsp;                        when (fieldType) {</b>
<b class="nc">&nbsp;                            &quot;start&quot; -&gt; binding.eventStartTime.error = msg</b>
<b class="nc">&nbsp;                            &quot;end&quot; -&gt; binding.eventEndTime.error = msg</b>
&nbsp;                            &quot;both&quot; -&gt; {
<b class="nc">&nbsp;                                binding.eventStartTime.error = msg</b>
<b class="nc">&nbsp;                                binding.eventEndTime.error = msg</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            },
<b class="nc">&nbsp;            calendar.get(Calendar.HOUR_OF_DAY),</b>
<b class="nc">&nbsp;            calendar.get(Calendar.MINUTE),</b>
<b class="nc">&nbsp;            is24HourFormat()</b>
&nbsp;        )
<b class="nc">&nbsp;        timePickerDialog.show()</b>
&nbsp;    }
&nbsp;
&nbsp;    private fun is24HourFormat(): Boolean {
<b class="nc">&nbsp;        return android.text.format.DateFormat.is24HourFormat(requireContext())</b>
&nbsp;    }
&nbsp;
&nbsp;    private val locationSearchLauncher =
<b class="nc">&nbsp;        registerForActivityResult(ActivityResultContracts.StartActivityForResult()) { result -&gt;</b>
<b class="nc">&nbsp;            if (result.resultCode == Activity.RESULT_OK &amp;&amp; result.data != null) {</b>
<b class="nc">&nbsp;                val locationName = result.data?.getStringExtra(&quot;location_name&quot;)</b>
<b class="nc">&nbsp;                val latitude = result.data?.getDoubleExtra(&quot;latitude&quot;, 0.0)</b>
<b class="nc">&nbsp;                val longitude = result.data?.getDoubleExtra(&quot;longitude&quot;, 0.0)</b>
<b class="nc">&nbsp;                binding.eventLocation.setText(locationName)</b>
<b class="nc">&nbsp;                eventLatitude = latitude.toString()</b>
<b class="nc">&nbsp;                eventLongitude = longitude.toString()</b>
<b class="nc">&nbsp;                viewModel.updateEventInfo(&quot;eventLocation&quot;, locationName ?: &quot;&quot;)</b>
<b class="nc">&nbsp;                viewModel.updateEventInfo(&quot;eventLong&quot;, latitude.toString())</b>
<b class="nc">&nbsp;                viewModel.updateEventInfo(&quot;eventLat&quot;, longitude.toString())</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;    @RequiresApi(Build.VERSION_CODES.O)
&nbsp;    private fun observeSaveEventState() {
<b class="nc">&nbsp;        if (key == &quot;create&quot;) {</b>
<b class="nc">&nbsp;            viewModel.saveEvent()</b>
&nbsp;        } else {
<b class="nc">&nbsp;            viewModel.updateEvent()</b>
&nbsp;        }
<b class="nc">&nbsp;        lifecycleScope.launch {</b>
<b class="nc">&nbsp;            viewModel.states.collect { result -&gt;</b>
<b class="nc">&nbsp;                when (result) {</b>
<b class="nc">&nbsp;                    is Response.Error -&gt; {</b>
<b class="nc">&nbsp;                        showGenericDialog(</b>
<b class="nc">&nbsp;                            message = &quot;Error: Couldn&#39;t save event, please try again later&quot;,</b>
<b class="nc">&nbsp;                            title = &quot;Event not saved&quot;,</b>
<b class="nc">&nbsp;                            iconResId = com.example.eventmanagement.R.drawable.ic_attention</b>
&nbsp;                        )
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    Response.Loading -&gt; binding.loaderOverlay.loaderOverlay.visibility =</b>
<b class="nc">&nbsp;                        View.VISIBLE</b>
&nbsp;
<b class="nc">&nbsp;                    is Response.Success -&gt; {</b>
<b class="nc">&nbsp;                        binding.loaderOverlay.loaderOverlay.visibility = View.GONE</b>
<b class="nc">&nbsp;                        Toast.makeText(requireContext(), &quot;Event Added!&quot;, Toast.LENGTH_SHORT).show()</b>
<b class="nc">&nbsp;                        dismiss()</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private fun showGenericDialog(message: String, title: String, iconResId: Int) {
<b class="nc">&nbsp;        binding.loaderOverlay.loaderOverlay.visibility = View.GONE</b>
<b class="nc">&nbsp;        val builder = MaterialAlertDialogBuilder(requireContext())</b>
<b class="nc">&nbsp;        builder.setMessage(message)</b>
<b class="nc">&nbsp;            .setTitle(title)</b>
<b class="nc">&nbsp;            .setIcon(iconResId)</b>
<b class="nc">&nbsp;            .setCancelable(false)</b>
<b class="nc">&nbsp;            .setPositiveButton(&quot;Confirm&quot;) { dialog, _ -&gt;</b>
<b class="nc">&nbsp;                dialog.cancel()</b>
&nbsp;            }
<b class="nc">&nbsp;        val alertDialog = builder.create()</b>
<b class="nc">&nbsp;        alertDialog.show()</b>
&nbsp;    }
&nbsp;
&nbsp;    fun setOnDismissListener(listener: () -&gt; Unit) {
<b class="nc">&nbsp;        onDismissListener = listener</b>
&nbsp;    }
&nbsp;
&nbsp;    override fun onDismiss(dialog: DialogInterface) {
<b class="nc">&nbsp;        super.onDismiss(dialog)</b>
<b class="nc">&nbsp;        onDismissListener?.invoke()</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-09-10 18:49</div>
</div>
</body>
</html>
